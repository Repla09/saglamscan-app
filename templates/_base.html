<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ t['ai_nutrition_analyzer'] }}{% endblock %} - SaglamScan</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/favicon.png') }}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- Global Styles --- */
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #607D8B;
            --background-light: #f1f8e9;
            --success-color: #2e7d32;
            --error-color: #c62828;
        }
        body { font-family: 'Roboto', sans-serif; margin: 0; background: var(--background-light); }
        .content { padding: 20px; }

        /* --- Reusable Components (Modal, Toast, Loader) --- */
        #toast-container { position: fixed; top: 80px; right: 20px; z-index: 1002; display: flex; flex-direction: column; gap: 10px; }
        .toast { padding: 15px 25px; color: white; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); font-weight: 600; opacity: 0; transform: translateX(100%); transition: all 0.5s ease-in-out; }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.toast-success { background-color: var(--success-color); }
        .toast.toast-error { background-color: var(--error-color); }
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 1001; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; }
        #modal-overlay.active { display: flex; opacity: 1; }
        #modal-container { background: white; border-radius: 12px; max-width: 450px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; transform: scale(0.95); transition: transform 0.3s ease-out; }
        #modal-overlay.active #modal-container { transform: scale(1); }
        .close-modal { position: absolute; top: 10px; right: 15px; font-size: 2.5em; line-height: 1; cursor: pointer; color: #aaa; }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); backdrop-filter: blur(5px); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        #loading-overlay .spinner { width: 60px; height: 60px; border: 7px solid #f3f3f3; border-top: 7px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Navbar Styles --- */
        .navbar { background: white; padding: 0 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: center; position: sticky; top: 0; z-index: 1000; }
        .navbar-container { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 1200px; }
        .navbar-left { display: flex; align-items: center; gap: 15px; }
        .navbar-brand img { height: 28px; width: auto; vertical-align: middle; }
        .navbar a { color: #333; text-decoration: none; padding: 14px 16px; font-weight: 600; border-radius: 4px; }
        .navbar a:hover { background-color: #f1f1f1; }

        /* NEW: Wrapper for all right-side elements */
        .navbar-right { display: flex; align-items: center; gap: 5px; /* Reduced gap */ }

        .user-menu, .language-switcher { position: relative; display: inline-block; }
        .user-button, .lang-button { background: none; border: none; font-size: 1em; cursor: pointer; display: flex; align-items: center; gap: 8px; font-family: 'Roboto', sans-serif; font-weight: 600; color: #333; padding: 14px 10px; border-radius: 4px; }
        .lang-button { border: 2px solid #ddd; border-radius: 20px; padding: 6px 12px; font-size: 0.9em; }
        .flag-icon { width: 22px; height: 22px; border-radius: 50%; object-fit: cover; }
        .dropdown-content { display: none; position: absolute; background-color: white; min-width: 160px; box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2); z-index: 1; right: 0; border-radius: 8px; overflow: hidden; }
        .dropdown-content a { display: flex; gap: 10px; padding: 12px 16px; color: black; }

        /* --- Hamburger Menu Styles --- */
        .navbar-toggler { display: none; background: transparent; border: none; cursor: pointer; padding: 10px; z-index: 1001; }
        .hamburger-box { width: 24px; height: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .hamburger-line { width: 100%; height: 3px; background-color: #333; border-radius: 3px; transition: all 0.3s ease-in-out; }
        .navbar-toggler.active .line-1 { transform: translateY(8.5px) rotate(45deg); }
        .navbar-toggler.active .line-2 { opacity: 0; }
        .navbar-toggler.active .line-3 { transform: translateY(-8.5px) rotate(-45deg); }

        /* Slide-Down Mobile Menu */
        .mobile-menu-links { position: absolute; top: 100%; left: 0; right: 0; z-index: 999; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; overflow: hidden; max-height: 0; transition: max-height 0.4s ease-out; }
        .mobile-menu-links.active { max-height: 500px; /* Animate to a large height */ }
        .mobile-menu-links > a { padding: 15px 20px; border-bottom: 1px solid #f0f0f0; }

        /* --- Responsive Styles --- */
        @media screen and (max-width: 992px) {
            .navbar-left a:not(.navbar-brand) { display: none; } /* Hide "How It Works" on main bar */
            .navbar-right-desktop { display: none; } /* Hide user menu / login buttons */
            .navbar-toggler { display: block; } /* Show hamburger */
        }

        /* Desktop hover for language dropdown */
        @media screen and (min-width: 993px) {
            .language-switcher:hover .dropdown-content { display: block; }
            .user-menu:hover .dropdown-content { display: block; }
        }

        /* Mobile click-toggle for language dropdown */
        .language-switcher.open .dropdown-content { display: block; }

    </style>
    {% block head_extra %}{% endblock %}
</head>
<body>

    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-left">
                <a href="{{ url_for('home') }}" class="navbar-brand">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="SaglamScan Logo">
                </a>
                <a href="{{ url_for('how_it_works') }}">{{ t['how_it_works'] }}</a>
            </div>

            <!-- NEW: .navbar-right wrapper for better mobile layout control -->
            <div class="navbar-right">
                <!-- SINGLE Language Switcher - works for all screen sizes -->
                <div class="language-switcher" id="language-switcher">
                    <button class="lang-button">
                        {% if lang == 'az' %}<img src="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/flags/4x3/az.svg" class="flag-icon"><span>AZ</span>{% else %}<img src="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/flags/4x3/gb.svg" class="flag-icon"><span>EN</span>{% endif %}
                    </button>
                    <div class="dropdown-content">
                        <a href="{{ url_for('set_language', lang='az') }}"><img src="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/flags/4x3/az.svg" class="flag-icon"><span>{{t['azerbaijani']}}</span></a>
                        <a href="{{ url_for('set_language', lang='en') }}"><img src="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.0/flags/4x3/gb.svg" class="flag-icon"><span>{{t['english']}}</span></a>
                    </div>
                </div>

                <!-- Desktop-only links -->
                <div class="navbar-right-desktop">
                    {% if user_name %}
                        <div class="user-menu">
                            <button class="user-button">...</button>
                            <div class="dropdown-content">
                                <a href="{{ url_for('account') }}">{{ t['my_account'] }}</a>
                                <a href="{{ url_for('history') }}">{{ t['scan_history'] }}</a>
                                <a id="logout-link" href="{{ url_for('logout') }}">{{ t['logout'] }}</a>
                            </div>
                        </div>
                    {% else %}
                        <a id="signup-link" href="{{ url_for('signup') }}">{{ t['sign_up'] }}</a>
                        <a id="login-link" href="{{ url_for('login') }}">{{ t['login'] }}</a>
                    {% endif %}
                </div>

                <!-- Hamburger Button (Mobile only) -->
                <button class="navbar-toggler" onclick="toggleMobileMenu()">
                    <div class="hamburger-box">
                        <div class="hamburger-line line-1"></div>
                        <div class="hamburger-line line-2"></div>
                        <div class="hamburger-line line-3"></div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Mobile Menu (slides down) -->
        <div class="mobile-menu-links" id="mobile-menu-links">
             <a href="{{ url_for('how_it_works') }}">{{ t['how_it_works'] }}</a>
            {% if user_name %}
                 <a href="{{ url_for('account') }}">{{ t['my_account'] }}</a>
                 <a href="{{ url_for('history') }}">{{ t['scan_history'] }}</a>
                 <a id="mobile-logout-link" href="{{ url_for('logout') }}">{{ t['logout'] }}</a>
            {% else %}
                <a href="#" id="mobile-signup-link">{{ t['sign_up'] }}</a>
                <a href="#" id="mobile-login-link">{{ t['login'] }}</a>
            {% endif %}
        </div>
    </nav>

    <main class="content">
        {% block content %}{% endblock %}
    </main>

    <!-- Modals, overlays, etc. -->
    <div id="modal-overlay">...</div>
    <div id="loading-overlay">...</div>
    <div id="toast-container"></div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script>
        // Firebase config and other JS...
        const firebaseConfig = { apiKey: "{{ firebase_web_api_key }}", authDomain: "nutrition-1366d.firebaseapp.com", projectId: "nutrition-1366d", storageBucket: "nutrition-1366d.appspot.com", appId: "1:667763097330:web:401e196cbfe19c8c49da6b" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // --- Event Listeners and Functions ---
        const mobileMenu = document.getElementById('mobile-menu-links');
        const langSwitcher = document.getElementById('language-switcher');

        function toggleMobileMenu() {
            document.querySelector('.navbar-toggler').classList.toggle('active');
            mobileMenu.classList.toggle('active');
        }

        // Language switcher logic for mobile
        langSwitcher.addEventListener('click', function(event) {
            if (window.innerWidth <= 992) {
                event.stopPropagation(); // Prevent document click listener from firing immediately
                this.classList.toggle('open');
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (langSwitcher.classList.contains('open') && !langSwitcher.contains(event.target)) {
                langSwitcher.classList.remove('open');
            }
        });

        // Other existing JS for modals, auth, etc. would go here...
    </script>
</body>
</html>